<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Too Hot Climate Campaign</title>
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-cog mr-3 text-blue-600"></i>
                    Admin Dashboard
                </h1>
                <p class="text-gray-600">Manage push notifications and view system status</p>
            </div>

            <!-- Expo Android Build QR Code Section -->
            {% if expo_apk_url %}
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 flex flex-col items-center">
              <h2 class="text-2xl font-bold text-gray-800 mb-2">
                <i class="fab fa-android mr-2 text-green-600"></i>
                Latest Android App Build
              </h2>
              <p class="text-gray-600 mb-4">Scan to install the latest preview build on your device:</p>
              <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data={{ expo_apk_url }}" alt="Expo Android Build QR Code" class="mb-4" style="width:200px;height:200px;"/>
              <a href="{{ expo_apk_url }}" target="_blank" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition-colors font-semibold">
                <i class="fas fa-download mr-2"></i>Download APK
              </a>
            </div>
            {% else %}
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 flex flex-col items-center">
              <h2 class="text-2xl font-bold text-gray-800 mb-2">
                <i class="fab fa-android mr-2 text-green-600"></i>
                Latest Android App Build
              </h2>
              {% if expo_apk_error %}
                <p class="text-red-600 font-semibold mb-2">{{ expo_apk_error }}</p>
              {% endif %}
              <p class="text-gray-600">No Android build available yet.</p>
            </div>
            {% endif %}
            <!-- End Expo Android Build QR Code Section -->

            <!-- Expo iOS Build QR Code Section -->
            {% if expo_ios_url %}
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 flex flex-col items-center">
              <h2 class="text-2xl font-bold text-gray-800 mb-2">
                <i class="fab fa-apple mr-2 text-gray-800"></i>
                Latest iPhone App Build
              </h2>
              <p class="text-gray-600 mb-4">Scan to install the latest preview build on your iOS device:</p>
              <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data={{ expo_ios_url }}" alt="Expo iOS Build QR Code" class="mb-4" style="width:200px;height:200px;"/>
              <a href="{{ expo_ios_url }}" target="_blank" class="bg-gray-800 text-white px-6 py-2 rounded-md hover:bg-gray-900 transition-colors font-semibold">
                <i class="fas fa-download mr-2"></i>Download iOS Build
              </a>
            </div>
            {% else %}
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 flex flex-col items-center">
              <h2 class="text-2xl font-bold text-gray-800 mb-2">
                <i class="fab fa-apple mr-2 text-gray-800"></i>
                Latest iPhone App Build
              </h2>
              {% if expo_ios_error %}
                <p class="text-red-600 font-semibold mb-2">{{ expo_ios_error }}</p>
              {% endif %}
              <p class="text-gray-600">No iOS build available yet.</p>
            </div>
            {% endif %}
            <!-- End Expo iOS Build QR Code Section -->

            <!-- Stats Cards -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                            <i class="fas fa-bell text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-semibold text-gray-800">Push Subscribers</h3>
                            <p class="text-2xl font-bold text-blue-600" id="subscriber-count">0</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600">
                            <i class="fas fa-envelope text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-semibold text-gray-800">Email Subscribers</h3>
                            <p class="text-2xl font-bold text-green-600" id="email-count">{{ email_subs|length }}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                            <i class="fas fa-thermometer-half text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-semibold text-gray-800">Temperature Alerts</h3>
                            <p class="text-2xl font-bold text-purple-600" id="alert-count">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Push Notification Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-bell mr-2 text-blue-600"></i>
                    Push Notifications
                </h2>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Send Test Notification</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                            <input type="text" id="notification-title" value="Climate Alert" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Body</label>
                            <input type="text" id="notification-body" value="Test notification from Too Hot campaign" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <button id="send-notification" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Send Notification
                    </button>
                </div>

                <div id="notification-result" class="hidden mt-4 p-4 rounded-md"></div>
            </div>

            <!-- System Logs Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-clipboard-list mr-2 text-purple-600"></i>
                    System Logs
                </h2>
                <div class="mb-4">
                    <label class="mr-2 font-semibold">Log Type:</label>
                    <select id="log-type" class="border rounded px-2 py-1">
                        <option value="all">All</option>
                        <option value="push">Push Notifications</option>
                        <option value="debug">Debug/Error</option>
                    </select>
                    <button onclick="loadLogs()" class="ml-4 bg-blue-600 text-white px-4 py-1 rounded">Refresh Logs</button>
                </div>
                <div id="logs-list" class="max-h-64 overflow-y-auto text-sm bg-gray-50 rounded p-2"></div>
            </div>

            <!-- Push Subscribers Table with Management -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-bell mr-2 text-blue-600"></i>
                    Push Subscribers
                </h2>
                <div id="push-subscribers-list" class="overflow-x-auto"></div>
            </div>

            <!-- Email Subscribers Table (unchanged) -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-envelope mr-2 text-green-600"></i>
                    Email Subscribers
                </h2>
                {% if email_subs and email_subs|length > 0 %}
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded shadow">
                        <thead>
                            <tr>
                                <th class="py-2 px-4">Email</th>
                                <th class="py-2 px-4">Location</th>
                                <th class="py-2 px-4">Subscribed At</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sub in email_subs %}
                            <tr>
                                <td class="py-2 px-4">{{ sub.email }}</td>
                                <td class="py-2 px-4">{{ sub.location }}</td>
                                <td class="py-2 px-4">{{ sub.subscribed_at }}</td>
                                <td class="py-2 px-4">
                                  <button class="px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 mr-1" onclick="sendTestAlertEmail('{{ sub.email }}', '{{ sub.location }}')">
                                    <i class="fas fa-envelope-open-text"></i> Test Alert
                                  </button>
                                  <button class="px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700 mr-1" onclick="resendWelcomeEmail('{{ sub.email }}', '{{ sub.location }}')">
                                    <i class="fas fa-paper-plane"></i> Resend Welcome
                                  </button>
                                  <button class="px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700" onclick="deleteSubscriber('{{ sub.email }}')">
                                    <i class="fas fa-trash"></i> Delete
                                  </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-gray-500">No email subscribers yet.</p>
                {% endif %}
            </div>

            <!-- Test Actions Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-vial mr-2 text-yellow-600"></i>
                    Test Actions
                </h2>
                <div class="mb-4">
                    <h3 class="font-semibold mb-2">Test Email Notification</h3>
                    <input type="email" id="test-email-input" placeholder="Enter email address" class="border px-2 py-1 rounded mr-2">
                    <button onclick="sendTestEmail()" class="bg-green-600 text-white px-4 py-1 rounded">Send Test Email</button>
                    <span id="test-email-result" class="ml-2 text-sm"></span>
                </div>
                <div class="mb-4">
                    <h3 class="font-semibold mb-2">Test Push Notification</h3>
                    <input type="text" id="test-push-title" placeholder="Title" class="border px-2 py-1 rounded mr-2" value="Test Notification">
                    <input type="text" id="test-push-body" placeholder="Body" class="border px-2 py-1 rounded mr-2" value="This is a test push notification.">
                    <button onclick="sendTestPush()" class="bg-blue-600 text-white px-4 py-1 rounded">Send Test Push</button>
                    <span id="test-push-result" class="ml-2 text-sm"></span>
                </div>
                <div>
                    <h3 class="font-semibold mb-2">Test Temperature Alert</h3>
                    <form id="test-alert-form" onsubmit="return false;">
                        <input type="text" id="alert-location" placeholder="Location" class="border px-2 py-1 rounded mr-2" value="New York">
                        <input type="number" id="alert-current-temp" placeholder="Current Temp (¬∞F)" class="border px-2 py-1 rounded mr-2">
                        <input type="number" id="alert-avg-temp" placeholder="Avg Temp (¬∞F)" class="border px-2 py-1 rounded mr-2">
                        <label class="mr-2"><input type="checkbox" id="alert-use-real-data"> Use Real Data</label>
                        <button onclick="sendTestAlert()" class="bg-yellow-600 text-white px-4 py-1 rounded">Test Alert</button>
                        <span id="test-alert-result" class="ml-2 text-sm"></span>
                    </form>
                </div>
            </div>

            <!-- System Status -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-server mr-2 text-purple-600"></i>
                    System Status
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Services</h3>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                <span class="text-sm">Flask App</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                <span class="text-sm">Push Notifications</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                <span class="text-sm">Service Worker</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                <span class="text-sm">VAPID Keys</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Quick Actions</h3>
                        <div class="space-y-2">
                            <button onclick="window.open('https://its2hot.org', '_blank')" 
                                    class="w-full text-left px-3 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors">
                                <i class="fas fa-external-link-alt mr-2"></i>
                                View Main Site
                            </button>
                            <button onclick="refreshData()" 
                                    class="w-full text-left px-3 py-2 bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>
                                Refresh Data
                            </button>
                            <a href="/admin/time-tracking" class="w-full text-left px-3 py-2 bg-gray-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors" style="text-decoration: none;">
                                <i class="fas fa-clock mr-2"></i> View Project Time Tracking
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Logs Section -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">
        <i class="fas fa-mobile-alt mr-2 text-blue-600"></i> Recent Mobile Logs
        <button onclick="loadMobileLogs()" class="ml-4 px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300"><i class="fas fa-sync-alt"></i> Refresh</button>
      </h2>
      <div id="mobile-logs-list" style="max-height: 350px; overflow-y: auto; font-size: 0.97rem;"></div>
    </div>

    <script>
        // Load initial data
        document.addEventListener('DOMContentLoaded', function() {
            loadSubscribers();
            loadStats();
            loadLogs();
            loadPushSubscribers();
        });

        // Send notification
        document.getElementById('send-notification').addEventListener('click', function() {
            const title = document.getElementById('notification-title').value;
            const body = document.getElementById('notification-body').value;
            
            if (!title || !body) {
                alert('Please fill in both title and body');
                return;
            }
            
            sendNotification(title, body);
        });

        function sendNotification(title, body) {
            const button = document.getElementById('send-notification');
            const originalText = button.innerHTML;
            
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sending...';
            
            fetch('/api/send-push-notification', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    title: title,
                    body: body,
                    url: '/'
                })
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('notification-result');
                resultDiv.className = data.success ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                resultDiv.innerHTML = `
                    <strong>${data.success ? '‚úÖ Success' : '‚ùå Error'}:</strong> ${data.message}
                    ${data.successful_sends ? `<br>‚úÖ Successful sends: ${data.successful_sends}` : ''}
                    ${data.failed_sends ? `<br>‚ùå Failed sends: ${data.failed_sends}` : ''}
                    ${data.total_subscribers ? `<br>üìä Total subscribers: ${data.total_subscribers}` : ''}
                `;
                resultDiv.classList.remove('hidden');
                
                // Refresh data
                setTimeout(() => {
                    loadSubscribers();
                    loadStats();
                }, 1000);
            })
            .catch(error => {
                const resultDiv = document.getElementById('notification-result');
                resultDiv.className = 'bg-red-100 text-red-700';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
                resultDiv.classList.remove('hidden');
            })
            .finally(() => {
                button.disabled = false;
                button.innerHTML = originalText;
            });
        }

        function loadSubscribers() {
            fetch('/api/push-subscribers')
            .then(response => response.json())
            .then(data => {
                document.getElementById('subscriber-count').textContent = data.subscribers ? data.subscribers.length : 0;
            })
            .catch(error => {
                console.error('Error loading subscribers:', error);
            });
        }

        function loadStats() {
            // Update subscriber count
            fetch('/api/push-subscribers')
            .then(response => response.json())
            .then(data => {
                document.getElementById('subscriber-count').textContent = data.subscribers ? data.subscribers.length : 0;
            })
            .catch(error => {
                console.error('Error loading stats:', error);
            });
        }

        function refreshData() {
            loadSubscribers();
            loadStats();
        }

        function testNotification() {
            document.getElementById('notification-title').value = 'Test Climate Alert';
            document.getElementById('notification-body').value = 'This is a test notification from the Too Hot climate awareness campaign!';
            sendNotification('Test Climate Alert', 'This is a test notification from the Too Hot climate awareness campaign!');
        }

        // --- System Logs ---
        function loadLogs() {
            const type = document.getElementById('log-type').value;
            fetch(`/api/logs?type=${type}`)
                .then(r => r.json())
                .then(data => {
                    let logsHtml = '';
                    if (type === 'push' && data.logs) {
                        logsHtml = data.logs.map(l => `<div>[${l.timestamp}] <b>${l.status}</b> - ${l.title || ''} (${l.device_type || ''}) ${l.error ? '<span class="text-red-600">' + l.error + '</span>' : ''}</div>`).join('');
                    } else if (type === 'debug' && data.logs) {
                        logsHtml = data.logs.map(l => `<div>[${l.timestamp}] <b>${l.source}</b> - ${l.message} (${l.context || ''})</div>`).join('');
                    } else if (data.push_logs || data.debug_logs) {
                        logsHtml = '<b>Push Logs:</b><br>' + data.push_logs.map(l => `[${l.timestamp}] <b>${l.status}</b> - ${l.title || ''} (${l.device_type || ''}) ${l.error ? '<span class="text-red-600">' + l.error + '</span>' : ''}`).join('<br>') + '<br><b>Debug Logs:</b><br>' + data.debug_logs.map(l => `[${l.timestamp}] <b>${l.source}</b> - ${l.message} (${l.context || ''})`).join('<br>');
                    } else {
                        logsHtml = '<i>No logs found.</i>';
                    }
                    document.getElementById('logs-list').innerHTML = logsHtml;
                });
        }

        // --- Push Subscribers Management ---
        function loadPushSubscribers() {
            fetch('/api/push-subscribers')
                .then(r => r.json())
                .then(data => {
                    if (data.subscribers && data.subscribers.length > 0) {
                        let html = `<table class='min-w-full bg-white rounded shadow'><thead><tr><th class='py-2 px-4'>ID</th><th class='py-2 px-4'>Token</th><th class='py-2 px-4'>Platform</th><th class='py-2 px-4'>Device</th><th class='py-2 px-4'>Registered</th><th class='py-2 px-4'>Actions</th></tr></thead><tbody>`;
                        html += data.subscribers.map(sub => `
                            <tr>
                                <td class='py-2 px-4'>${sub.id}</td>
                                <td class='py-2 px-4'>${sub.push_token ? sub.push_token : 'Unknown'}</td>
                                <td class='py-2 px-4'>${sub.platform || 'N/A'}</td>
                                <td class='py-2 px-4'>${sub.device_type || 'N/A'}</td>
                                <td class='py-2 px-4'>${sub.registered_at ? new Date(sub.registered_at).toLocaleString() : 'Unknown'}</td>
                                <td class='py-2 px-4'><button onclick="deletePushSubscriber(${sub.id})" class='bg-red-600 text-white px-2 py-1 rounded'>Delete</button></td>
                            </tr>
                        `).join('');
                        html += '</tbody></table>';
                        document.getElementById('push-subscribers-list').innerHTML = html;
                    } else {
                        document.getElementById('push-subscribers-list').innerHTML = '<p class="text-gray-500">No push subscribers yet.</p>';
                    }
                });
        }
        function deletePushSubscriber(id) {
            if (!confirm('Are you sure you want to delete this push subscriber?')) return;
            fetch(`/api/push-subscriber/${id}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    alert(data.message || 'Deleted');
                    loadPushSubscribers();
                });
        }

        // --- Test Actions ---
        function sendTestEmail() {
            const email = document.getElementById('test-email-input').value;
            if (!email) return alert('Enter an email address');
            fetch('/admin/send-test-email', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email })
            })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('test-email-result').textContent = data.message || data.error || '';
                });
        }
        function sendTestPush() {
            const title = document.getElementById('test-push-title').value;
            const body = document.getElementById('test-push-body').value;
            fetch('/api/send-push-notification', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, body, url: '/' })
            })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('test-push-result').textContent = data.message || data.error || '';
                    loadLogs();
                });
        }
        function sendTestAlert() {
            const location = document.getElementById('alert-location').value;
            const useReal = document.getElementById('alert-use-real-data').checked;
            const currentTemp = document.getElementById('alert-current-temp').value;
            const avgTemp = document.getElementById('alert-avg-temp').value;
            fetch('/api/test-temperature-alert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    location,
                    use_real_data: useReal,
                    current_temp: currentTemp ? parseFloat(currentTemp) : undefined,
                    avg_temp: avgTemp ? parseFloat(avgTemp) : undefined
                })
            })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('test-alert-result').textContent = data.success ? `Alert: ${data.location}, Current: ${data.current_temp}, Avg: ${data.avg_temp}, Diff: ${data.temp_diff}` : (data.error || 'Error');
                    loadLogs();
                });
        }

        function sendTestAlertEmail(email, location) {
          if (!confirm('Send a test climate alert email to ' + email + '?')) return;
          fetch('/admin/send-test-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, location })
          })
            .then(r => r.json())
            .then(data => alert(data.message || data.error || 'Done'));
        }
        function resendWelcomeEmail(email, location) {
          if (!confirm('Resend welcome email to ' + email + '?')) return;
          fetch('/admin/resend-welcome', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, location })
          })
            .then(r => r.json())
            .then(data => alert(data.message || data.error || 'Done'));
        }
        function deleteSubscriber(email) {
          if (!confirm('Delete subscriber ' + email + '? This cannot be undone.')) return;
          fetch('/admin/delete-subscriber', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          })
            .then(r => r.json())
            .then(data => {
              alert(data.message || data.error || 'Done');
              if (data.success) location.reload();
            });
        }

        function loadMobileLogs() {
          fetch('/admin/mobile-logs')
            .then(r => r.json())
            .then(data => {
              const logs = data.logs || [];
              const listDiv = document.getElementById('mobile-logs-list');
              if (logs.length === 0) {
                listDiv.innerHTML = '<div class="text-gray-500">No mobile logs found.</div>';
                return;
              }
              listDiv.innerHTML = logs.map(log => `
                <div class="border-b py-2 px-1 flex flex-col">
                  <div class="flex items-center mb-1">
                    <span class="font-semibold text-blue-700 mr-2">${log.platform || log.source || ''}</span>
                    <span class="text-xs text-gray-500 mr-2">${log.deviceModel || ''}</span>
                    <span class="text-xs text-gray-400">${log.timestamp ? log.timestamp.replace('T', ' ').slice(0, 19) : ''}</span>
                  </div>
                  <div class="text-xs text-gray-600 mb-1">${log.context || ''}</div>
                  <div class="text-gray-900">${log.message}</div>
                </div>
              `).join('');
            });
        }
        // Load on page load
        loadMobileLogs();
    </script>
</body>
</html> 